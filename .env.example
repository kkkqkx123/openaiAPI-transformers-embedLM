# Embedding Model Provider API 配置示例
# 复制此文件为 .env 并根据需要修改配置

# 模型配置

# 模型存储路径
# Windows: EMB_PROVIDER_MODEL_PATH=D:\models\all-MiniLM-L12-v2
# Linux/Mac: EMB_PROVIDER_MODEL_PATH=/models/all-MiniLM-L12-v2
EMB_PROVIDER_MODEL_PATH=D:\models\all-MiniLM-L12-v2

# 模型名称（用于从 Hugging Face Hub 下载）
EMB_PROVIDER_MODEL_NAME=all-MiniLM-L12-v2

# 处理配置

# 最大批处理大小（同时处理的最大文本数量）
# 建议值：CPU: 8-16, GPU: 16-64
EMB_PROVIDER_MAX_BATCH_SIZE=32

# 最大上下文长度（单个文本的最大 token 数量）
# all-MiniLM-L12-v2 支持的最大长度：512
EMB_PROVIDER_MAX_CONTEXT_LENGTH=512

# 嵌入向量维度
# all-MiniLM-L12-v2 产生的嵌入维度：384
EMB_PROVIDER_EMBEDDING_DIMENSION=384

# 批处理优化配置

# 启用动态批处理（根据请求到达情况动态调整批处理大小）
EMB_PROVIDER_ENABLE_DYNAMIC_BATCHING=true

# 动态批处理最大等待时间（毫秒）
# 系统会等待指定时间以收集更多请求形成更大的批次
EMB_PROVIDER_MAX_WAIT_TIME_MS=100

# 动态批处理最小批次大小
# 即使等待时间未到，达到最小批次大小也会开始处理
EMB_PROVIDER_MIN_BATCH_SIZE=12

# 启用基于长度的分组（将相似长度的文本分组处理以减少padding开销）
EMB_PROVIDER_ENABLE_LENGTH_GROUPING=true

# 长度分组容忍度（0.1-0.5）
# 0.2表示组内文本长度差异不超过20%
EMB_PROVIDER_LENGTH_GROUP_TOLERANCE=0.2

# 资源配置

# 内存限制
# 格式：数字 + 单位（KB, MB, GB）
EMB_PROVIDER_MEMORY_LIMIT=2GB

# 计算设备
# 可选值：auto（自动选择）, cpu, cuda, mps
EMB_PROVIDER_DEVICE=auto

# API 配置

# 服务器绑定主机
# 生产环境建议：0.0.0.0（接受所有接口的连接）
# 开发环境建议：localhost（仅本地访问）
EMB_PROVIDER_HOST=localhost

# 服务器端口
EMB_PROVIDER_PORT=9000

# =============================================================================
# 日志配置
# =============================================================================

# 日志级别
# 可选值：DEBUG, INFO, WARNING, ERROR
# DEBUG: 包含详细调试信息
# INFO: 一般信息（推荐生产环境使用）
# WARNING: 仅警告和错误
# ERROR: 仅错误信息
EMB_PROVIDER_LOG_LEVEL=INFO

# 启用文件日志输出
# true: 启用文件日志，false: 仅控制台输出
EMB_PROVIDER_LOG_TO_FILE=true

# 日志文件目录
# 相对于项目根目录的路径
EMB_PROVIDER_LOG_DIR=logs

# 单个日志文件最大大小（MB）
# 超过此大小将创建新文件并压缩旧文件
EMB_PROVIDER_LOG_FILE_MAX_SIZE=5

# 默认日志保留天数
# 正常情况下保留多少天的日志文件
EMB_PROVIDER_LOG_RETENTION_DAYS=7

# 日志清理检查间隔（小时）
# 系统每隔多少小时检查一次是否需要清理日志
EMB_PROVIDER_LOG_CLEANUP_INTERVAL_HOURS=1

# 日志目录最大大小（MB）
# 当日志目录总大小超过此值时触发清理
EMB_PROVIDER_LOG_MAX_DIR_SIZE_MB=10

# 清理目标大小（MB）
# 清理后尝试达到的目标大小（应小于最大大小）
EMB_PROVIDER_LOG_CLEANUP_TARGET_SIZE_MB=5

# 清理策略保留天数（按顺序尝试）
# 当目录过大时，依次尝试保留这些天数的日志
# 格式：用逗号分隔的数字列表
EMB_PROVIDER_LOG_CLEANUP_RETENTION_DAYS=7,3,1

# 示例配置场景

# --- 开发环境配置 ---
# EMB_PROVIDER_HOST=localhost
# EMB_PROVIDER_LOG_LEVEL=DEBUG
# EMB_PROVIDER_LOG_TO_FILE=true
# EMB_PROVIDER_LOG_FILE_MAX_SIZE=5
# EMB_PROVIDER_LOG_RETENTION_DAYS=3
# EMB_PROVIDER_MAX_BATCH_SIZE=8

# --- 生产环境配置（CPU） ---
# EMB_PROVIDER_HOST=0.0.0.0
# EMB_PROVIDER_LOG_LEVEL=INFO
# EMB_PROVIDER_LOG_TO_FILE=true
# EMB_PROVIDER_LOG_FILE_MAX_SIZE=10
# EMB_PROVIDER_LOG_RETENTION_DAYS=7
# EMB_PROVIDER_LOG_MAX_DIR_SIZE_MB=5
# EMB_PROVIDER_DEVICE=cpu
# EMB_PROVIDER_MAX_BATCH_SIZE=64
# EMB_PROVIDER_MEMORY_LIMIT=2GB

# --- 生产环境配置（GPU） ---
# EMB_PROVIDER_HOST=0.0.0.0
# EMB_PROVIDER_LOG_LEVEL=INFO
# EMB_PROVIDER_LOG_TO_FILE=true
# EMB_PROVIDER_LOG_FILE_MAX_SIZE=20
# EMB_PROVIDER_LOG_RETENTION_DAYS=7
# EMB_PROVIDER_LOG_MAX_DIR_SIZE_MB=20
# EMB_PROVIDER_DEVICE=cuda
# EMB_PROVIDER_MAX_BATCH_SIZE=64
# EMB_PROVIDER_MEMORY_LIMIT=2GB

# --- 资源受限配置 ---
# EMB_PROVIDER_LOG_TO_FILE=true
# EMB_PROVIDER_LOG_FILE_MAX_SIZE=5
# EMB_PROVIDER_LOG_RETENTION_DAYS=3
# EMB_PROVIDER_LOG_MAX_DIR_SIZE_MB=3
# EMB_PROVIDER_MAX_BATCH_SIZE=4
# EMB_PROVIDER_MEMORY_LIMIT=1GB
# EMB_PROVIDER_DEVICE=cpu

# --- 仅控制台日志配置（适用于容器环境） ---
# EMB_PROVIDER_LOG_TO_FILE=false
# EMB_PROVIDER_LOG_LEVEL=INFO