# 处理配置

# 最大批处理大小（同时处理的最大文本数量）
EMB_PROVIDER_MAX_BATCH_SIZE=32

# 最大上下文长度（单个文本的最大 token 数量）
# all-MiniLM-L12-v2 支持的最大长度：512
EMB_PROVIDER_MAX_CONTEXT_LENGTH=512
# 嵌入向量维度
EMB_PROVIDER_EMBEDDING_DIMENSION=384

# 批处理优化配置

# 启用动态批处理（根据请求到达情况动态调整批处理大小）
EMB_PROVIDER_ENABLE_DYNAMIC_BATCHING=true
# 动态批处理最大等待时间（毫秒）
EMB_PROVIDER_MAX_WAIT_TIME_MS=100
# 动态批处理最小批次大小
EMB_PROVIDER_MIN_BATCH_SIZE=12

# 启用基于长度的分组（将相似长度的文本分组处理以减少padding开销）
EMB_PROVIDER_ENABLE_LENGTH_GROUPING=true
# 长度分组容忍度（0.1-0.5）
EMB_PROVIDER_LENGTH_GROUP_TOLERANCE=0.2

# 资源配置
EMB_PROVIDER_MEMORY_LIMIT=2GB
# 计算设备
# 可选值：auto（自动选择）, cpu, cuda, mps
EMB_PROVIDER_DEVICE=cpu

# API 配置
EMB_PROVIDER_HOST=localhost
# 服务器端口
EMB_PROVIDER_PORT=9000

# 日志配置
EMB_PROVIDER_LOG_LEVEL=INFO
# 启用文件日志输出
EMB_PROVIDER_LOG_TO_FILE=true
# 日志文件目录相对于项目根目录的路径
EMB_PROVIDER_LOG_DIR=logs
# 单个日志文件最大大小（MB）
# 超过此大小将创建新文件并压缩旧文件
EMB_PROVIDER_LOG_FILE_MAX_SIZE=5
# 默认日志保留天数
EMB_PROVIDER_LOG_RETENTION_DAYS=7
# 日志清理检查间隔（小时）
EMB_PROVIDER_LOG_CLEANUP_INTERVAL_HOURS=1
# 日志目录最大大小（MB）
# 当日志目录总大小超过此值时触发清理
EMB_PROVIDER_LOG_MAX_DIR_SIZE_MB=10
# 清理目标大小（MB）
# 清理后尝试达到的目标大小（应小于最大大小）
EMB_PROVIDER_LOG_CLEANUP_TARGET_SIZE_MB=5
# 清理策略保留天数（按顺序尝试）
# 当目录过大时，依次尝试保留这些天数的日志
# 格式：用逗号分隔的数字列表
EMB_PROVIDER_LOG_CLEANUP_RETENTION_DAYS=7,3,1

# 多模型配置示例（JSON格式）
# source: huggingface, modelscope, local
EMB_PROVIDER_MODEL_MAPPING='{
    "mini": {
        "name": "sentence-transformers/all-MiniLM-L12-v2",
        "model_path": "D:/models/all-MiniLM-L12-v2",
        "source": "huggingface",
        "storage_precision": "fp16",
        "compute_precision": "fp16"
    },
    "default": {
        "name": "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2",
        "model_path": "D:/models/multilingual-MiniLM-L12-v2",
        "source": "local",
        "storage_precision": "fp16",
        "compute_precision": "fp16"
    },
    "qwen3": {
        "name": "Qwen/Qwen3-Embedding-0.6B",
        "model_path": "D:/models/qwen-embedding-0.6b",
        "source": "local",
        "storage_precision": "fp16",
        "compute_precision": "fp16"
    },
    "jina-code": {
        "name": "jinaai/jina-code-embeddings-0.5b",
        "model_path": "D:/models/jina-code-emb-0.5b",
        "source": "local",
        "storage_precision": "fp16",
        "compute_precision": "fp16"
    }
}'

# 精度配置
# 存储精度：auto, fp32, fp16, fp8, nf4, int8, int4
EMB_PROVIDER_MODEL_STORAGE_PRECISION=auto
# 计算精度：auto, fp32, fp16, bf16, tf32
EMB_PROVIDER_MODEL_COMPUTE_PRECISION=auto
# 存储配置（JSON格式）
EMB_PROVIDER_STORAGE_CONFIG="{}"
# 计算配置（JSON格式）
EMB_PROVIDER_COMPUTE_CONFIG="{}"
# 是否验证精度兼容性
EMB_PROVIDER_PRECISION_VALIDATION=true

# 预加载模型配置
# 预加载模型列表（逗号分隔的模型别名列表）
# 例如：EMB_PROVIDER_PRELOAD_MODELS="mini,qwen3"
# 这些模型将在服务启动时被加载到内存中
EMB_PROVIDER_PRELOAD_MODELS="default"

# 动态模型加载控制
# 当设置为 false 时，只允许预加载列表中的模型被使用
# 非预加载模型的请求将返回错误
EMB_PROVIDER_ENABLE_DYNAMIC_MODEL_LOADING=false
